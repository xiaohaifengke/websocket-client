{"version":3,"sources":["../../src/util/events.js"],"names":["isPromise","EventHub","on","event","func","_events","Object","create","Array","isArray","i","l","length","push","once","$this","off","apply","arguments","cbs","cb","splice","trigger","res","args","_handled","catch","e","console","error"],"mappings":"AAAA,SAASA,SAAT,QAA0B,SAA1B;AAEA,OAAO,MAAMC,QAAN,CAAe;AAElBC,EAAAA,EAAE,CAAEC,KAAF,EAASC,IAAT,EAAe;AACb,QAAI,CAAC,KAAKC,OAAV,EAAmB,KAAKA,OAAL,GAAeC,MAAM,CAACC,MAAP,CAAc,IAAd,CAAf;;AACnB,QAAIC,KAAK,CAACC,OAAN,CAAcN,KAAd,CAAJ,EAA0B;AACtB,WAAK,IAAIO,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAGR,KAAK,CAACS,MAA1B,EAAkCF,CAAC,GAAGC,CAAtC,EAAyCD,CAAC,EAA1C,EAA8C;AAC1C,aAAKR,EAAL,CAAQC,KAAK,CAACO,CAAD,CAAb,EAAkBN,IAAlB;AACH;AACJ,KAJD,MAIO;AACH,OAAC,KAAKC,OAAL,CAAaF,KAAb,MAAwB,KAAKE,OAAL,CAAaF,KAAb,IAAsB,EAA9C,CAAD,EAAoDU,IAApD,CAAyDT,IAAzD;AACH;;AACD,WAAO,IAAP;AACH;;AAEDU,EAAAA,IAAI,CAAEX,KAAF,EAASC,IAAT,EAAe;AACf,QAAMW,KAAK,GAAG,IAAd;;AAEA,aAASD,IAAT,GAAiB;AACbC,MAAAA,KAAK,CAACC,GAAN,CAAUb,KAAV,EAAiBW,IAAjB;AACAV,MAAAA,IAAI,CAACa,KAAL,CAAWF,KAAX,EAAkBG,SAAlB;AACH;;AAEDJ,IAAAA,IAAI,CAACV,IAAL,GAAYA,IAAZ;AACA,SAAKF,EAAL,CAAQC,KAAR,EAAeW,IAAf;AACA,WAAO,IAAP;AACH;;AAEDE,EAAAA,GAAG,CAAEb,KAAF,EAASC,IAAT,EAAe;AACd;AACA,QAAI,CAACc,SAAS,CAACN,MAAf,EAAuB;AACnB,WAAKP,OAAL,GAAeC,MAAM,CAACC,MAAP,CAAc,IAAd,CAAf;AACA,aAAO,IAAP;AACH,KALa,CAMd;;;AACA,QAAIC,KAAK,CAACC,OAAN,CAAcN,KAAd,CAAJ,EAA0B;AACtB,WAAK,IAAIO,EAAC,GAAG,CAAR,EAAWC,CAAC,GAAGR,KAAK,CAACS,MAA1B,EAAkCF,EAAC,GAAGC,CAAtC,EAAyCD,EAAC,EAA1C,EAA8C;AAC1C,aAAKM,GAAL,CAASb,KAAK,CAACO,EAAD,CAAd,EAAmBN,IAAnB;AACH;;AACD,aAAO,IAAP;AACH,KAZa,CAad;;;AACA,QAAMe,GAAG,GAAG,KAAKd,OAAL,CAAaF,KAAb,CAAZ;;AACA,QAAI,CAACgB,GAAL,EAAU;AACN,aAAO,IAAP;AACH;;AACD,QAAI,CAACf,IAAL,EAAW;AACP,WAAKC,OAAL,CAAaF,KAAb,IAAsB,IAAtB;AACA,aAAO,IAAP;AACH,KArBa,CAsBd;;;AACA,QAAIiB,EAAJ;AACA,QAAIV,CAAC,GAAGS,GAAG,CAACP,MAAZ;;AACA,WAAOF,CAAC,EAAR,EAAY;AACRU,MAAAA,EAAE,GAAGD,GAAG,CAACT,CAAD,CAAR;;AACA,UAAIU,EAAE,KAAKhB,IAAP,IAAegB,EAAE,CAAChB,IAAH,KAAYA,IAA/B,EAAqC;AACjCe,QAAAA,GAAG,CAACE,MAAJ,CAAWX,CAAX,EAAc,CAAd;AACA;AACH;AACJ;;AACD,WAAO,IAAP;AACH;;AAEDY,EAAAA,OAAO,CAAEnB,KAAF,EAAkB;AACrB,QAAIgB,GAAG,GAAG,KAAKd,OAAL,CAAaF,KAAb,CAAV;;AACA,QAAIgB,GAAJ,EAAS;AACLA,MAAAA,GAAG,GAAG,CAAC,GAAGA,GAAJ,CAAN;AACA,UAAII,GAAJ;;AAFK,wCAFMC,IAEN;AAFMA,QAAAA,IAEN;AAAA;;AAGL,WAAK,IAAId,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAGQ,GAAG,CAACP,MAAxB,EAAgCF,CAAC,GAAGC,CAApC,EAAuCD,CAAC,EAAxC,EAA4C;AACxC,YAAI;AACAa,UAAAA,GAAG,GAAGJ,GAAG,CAACT,CAAD,CAAH,CAAOO,KAAP,CAAa,IAAb,EAAmBO,IAAnB,CAAN;;AACA,cAAID,GAAG,IAAIvB,SAAS,CAACuB,GAAD,CAAhB,IAAyB,CAACA,GAAG,CAACE,QAAlC,EAA4C;AACxCF,YAAAA,GAAG,CAACG,KAAJ,CAAUC,CAAC,IAAIC,OAAO,CAACC,KAAR,CAAcF,CAAd,CAAf;AACAJ,YAAAA,GAAG,CAACE,QAAJ,GAAe,IAAf;AACH;AACJ,SAND,CAME,OAAOE,CAAP,EAAU;AACRC,UAAAA,OAAO,CAACC,KAAR,CAAcF,CAAd;AACH;AACJ;AACJ;;AACD,WAAO,IAAP;AACH;;AAhFiB","sourcesContent":["import { isPromise } from './index'\r\n\r\nexport class EventHub {\r\n\r\n    on (event, func) {\r\n        if (!this._events) this._events = Object.create(null)\r\n        if (Array.isArray(event)) {\r\n            for (let i = 0, l = event.length; i < l; i++) {\r\n                this.on(event[i], func)\r\n            }\r\n        } else {\r\n            (this._events[event] || (this._events[event] = [])).push(func)\r\n        }\r\n        return this\r\n    }\r\n\r\n    once (event, func) {\r\n        const $this = this\r\n\r\n        function once () {\r\n            $this.off(event, once)\r\n            func.apply($this, arguments)\r\n        }\r\n\r\n        once.func = func\r\n        this.on(event, once)\r\n        return this\r\n    }\r\n\r\n    off (event, func) {\r\n        // all\r\n        if (!arguments.length) {\r\n            this._events = Object.create(null)\r\n            return this\r\n        }\r\n        // array of events\r\n        if (Array.isArray(event)) {\r\n            for (let i = 0, l = event.length; i < l; i++) {\r\n                this.off(event[i], func)\r\n            }\r\n            return this\r\n        }\r\n        // specific event\r\n        const cbs = this._events[event]\r\n        if (!cbs) {\r\n            return this\r\n        }\r\n        if (!func) {\r\n            this._events[event] = null\r\n            return this\r\n        }\r\n        // specific handler\r\n        let cb\r\n        let i = cbs.length\r\n        while (i--) {\r\n            cb = cbs[i]\r\n            if (cb === func || cb.func === func) {\r\n                cbs.splice(i, 1)\r\n                break\r\n            }\r\n        }\r\n        return this\r\n    }\r\n\r\n    trigger (event, ...args) {\r\n        let cbs = this._events[event]\r\n        if (cbs) {\r\n            cbs = [...cbs]\r\n            let res\r\n            for (let i = 0, l = cbs.length; i < l; i++) {\r\n                try {\r\n                    res = cbs[i].apply(this, args)\r\n                    if (res && isPromise(res) && !res._handled) {\r\n                        res.catch(e => console.error(e))\r\n                        res._handled = true\r\n                    }\r\n                } catch (e) {\r\n                    console.error(e)\r\n                }\r\n            }\r\n        }\r\n        return this\r\n    }\r\n}"],"file":"events.js"}