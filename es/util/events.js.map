{"version":3,"sources":["../../src/util/events.js"],"names":["isPromise","EventHub","event","func","_events","Object","create","Array","isArray","i","l","length","on","push","$this","once","off","apply","arguments","cbs","cb","splice","res","args","_handled","catch","e","console","error"],"mappings":"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","sourcesContent":["import { isPromise } from './index'\r\n\r\nexport class EventHub {\r\n  on (event, func) {\r\n    if (!this._events) this._events = Object.create(null)\r\n    if (Array.isArray(event)) {\r\n      for (let i = 0, l = event.length; i < l; i++) {\r\n        this.on(event[i], func)\r\n      }\r\n    } else {\r\n      ;(this._events[event] || (this._events[event] = [])).push(func)\r\n    }\r\n    return this\r\n  }\r\n\r\n  once (event, func) {\r\n    const $this = this\r\n\r\n    function once () {\r\n      $this.off(event, once)\r\n      func.apply($this, arguments)\r\n    }\r\n\r\n    once.func = func\r\n    this.on(event, once)\r\n    return this\r\n  }\r\n\r\n  off (event, func) {\r\n    // all\r\n    if (!arguments.length) {\r\n      this._events = Object.create(null)\r\n      return this\r\n    }\r\n    // array of events\r\n    if (Array.isArray(event)) {\r\n      for (let i = 0, l = event.length; i < l; i++) {\r\n        this.off(event[i], func)\r\n      }\r\n      return this\r\n    }\r\n    // specific event\r\n    const cbs = this._events[event]\r\n    if (!cbs) {\r\n      return this\r\n    }\r\n    if (!func) {\r\n      this._events[event] = null\r\n      return this\r\n    }\r\n    // specific handler\r\n    let cb\r\n    let i = cbs.length\r\n    while (i--) {\r\n      cb = cbs[i]\r\n      if (cb === func || cb.func === func) {\r\n        cbs.splice(i, 1)\r\n        break\r\n      }\r\n    }\r\n    return this\r\n  }\r\n\r\n  trigger (event, ...args) {\r\n    let cbs = this._events[event]\r\n    if (cbs) {\r\n      cbs = [...cbs]\r\n      let res\r\n      for (let i = 0, l = cbs.length; i < l; i++) {\r\n        try {\r\n          res = cbs[i].apply(this, args)\r\n          if (res && isPromise(res) && !res._handled) {\r\n            res.catch(e => console.error(e))\r\n            res._handled = true\r\n          }\r\n        } catch (e) {\r\n          console.error(e)\r\n        }\r\n      }\r\n    }\r\n    return this\r\n  }\r\n}\r\n"],"file":"events.js"}